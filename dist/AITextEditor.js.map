{"version":3,"file":"AITextEditor.js","sources":["../src/AITextEditor.ts"],"sourcesContent":["/**\n * AITextEditor Web Component\n * A text editor with AI-powered text continuation suggestions\n */\n\nconst AI_TEXT_EDITOR_API_KEY = 'ai-text-editor-api-key';\n\nexport interface AITextEditorConfig {\n  apiKey?: string;\n  suggestionDelay?: number; // Delay in seconds before showing AI suggestions\n  systemPrompt?: string;\n  apiEndpoint?: string;\n  modelName?: string;\n  context?: string;\n  embedded?: boolean;\n  onStatusChange?: (hasApiKey: boolean) => void;\n  onLoadingChange?: (isLoading: boolean) => void;\n}\n\nexport class AITextEditorElement extends HTMLElement {\n  declare shadowRoot: ShadowRoot;\n  private editor!: HTMLTextAreaElement;\n  private editorBackground!: HTMLElement;\n  private loading!: HTMLElement;\n  private editorStatus!: HTMLElement;\n\n  private typingTimer: number | null = null;\n  private fullSuggestion: string | null = null;\n  private suggestionParagraphs: string[] = [];\n  private currentParagraphIndex: number = 0;\n  private isShowingSuggestion: boolean = false;\n\n  private apiKey: string = '';\n  private suggestionDelay: number = 1000; // Stored in milliseconds (default: 1000ms = 1 second)\n  private systemPrompt: string = \"You are a helpful writing assistant. Continue the user's text naturally and coherently. Provide 1-3 sentences that would logically follow their writing. Keep the same tone and style. Do not repeat what they've already written.\";\n  private apiEndpoint: string = 'https://api.openai.com/v1/chat/completions';\n  private modelName: string = 'gpt-3.5-turbo';\n  private context: string = '';\n  \n  private embedded: boolean = false;\n  private onStatusChangeCallback?: (hasApiKey: boolean) => void;\n  private onLoadingChangeCallback?: (isLoading: boolean) => void;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.render();\n    this.init();\n  }\n\n  /**\n   * Renders the component's HTML structure\n   */\n  private render(): void {\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n          width: 100%;\n          height: 100%;\n        }\n\n        .editor-container {\n          position: relative;\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .editor-status {\n          position: absolute;\n          top: 5px;\n          left: 5px;\n          width: 10px;\n          height: 10px;\n          border-radius: 100%;\n          background: #777;\n          z-index: 10;\n        }\n        \n        :host([embedded]) .editor-status {\n          display: none;\n        }\n\n        .editor-wrapper {\n          position: relative;\n          width: 100%;\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .editor {\n          width: 100%;\n          height: 100%;\n          border: 2px solid #e1e5e9;\n          border-radius: 12px;\n          padding: 20px;\n          font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n          font-size: 14px;\n          line-height: 1.6;\n          resize: none;\n          background: #fafbfc;\n          transition: all 0.3s ease;\n          position: relative;\n          z-index: 2;\n          background: transparent;\n          box-sizing: border-box;\n          min-height: auto;\n        }\n        \n        :host([embedded]) .editor {\n          border: none;\n          border-radius: 0;\n        }\n\n        .editor:focus {\n          outline: none;\n          border-color: #4facfe;\n          box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);\n        }\n        \n        :host([embedded]) .editor:focus {\n          box-shadow: none;\n        }\n\n        .editor-background {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          border: 2px solid #e1e5e9;\n          border-radius: 12px;\n          padding: 20px;\n          font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n          font-size: 14px;\n          line-height: 1.6;\n          background: #fafbfc;\n          z-index: 1;\n          pointer-events: none;\n          white-space: pre-wrap;\n          word-wrap: break-word;\n          overflow: hidden;\n          color: transparent;\n          box-sizing: border-box;\n        }\n        \n        :host([embedded]) .editor-background {\n          border: none;\n          border-radius: 0;\n        }\n\n        .editor-wrapper:focus-within .editor-background {\n          background: white;\n          border-color: #4facfe;\n        }\n        \n        :host([embedded]) .editor-wrapper:focus-within .editor-background {\n          border-color: transparent;\n        }\n\n        .suggestion-text {\n          color: #bbb;\n          position: relative;\n        }\n\n        .suggestion-text.accepted {\n          color: #ddd;\n          text-decoration: line-through;\n        }\n\n        .loading {\n          position: absolute;\n          top: 5px;\n          right: 10px;\n          z-index: 10;\n          display: none;\n        }\n        \n        :host([embedded]) .loading {\n          display: none !important;\n        }\n\n        .loading.show {\n          display: block;\n        }\n\n        .spinner {\n          width: 10px;\n          height: 10px;\n          border: 2px solid #e1e5e9;\n          border-top: 2px solid #4facfe;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      </style>\n\n      <div class=\"editor-container\">\n        <div class=\"editor-status\"></div>\n        <div class=\"loading\" id=\"loading\">\n          <div class=\"spinner\"></div>\n        </div>\n\n        <div class=\"editor-wrapper\">\n          <div class=\"editor-background\" id=\"editorBackground\"></div>\n          <textarea\n            class=\"editor\"\n            id=\"editor\"\n            placeholder=\"Start writing your markdown text here...\"\n          ></textarea>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Initializes the component after rendering\n   */\n  private init(): void {\n    const editor = this.shadowRoot.getElementById('editor') as HTMLTextAreaElement;\n    const editorBackground = this.shadowRoot.getElementById('editorBackground') as HTMLElement;\n    const loading = this.shadowRoot.getElementById('loading') as HTMLElement;\n\n    this.editorStatus = this.shadowRoot.querySelector('.editor-status') as HTMLElement;\n    this.editor = editor;\n    this.editorBackground = editorBackground;\n    this.loading = loading;\n\n    this.editor.addEventListener('input', () => {\n      this.handleTextInput();\n      this.updateBackground();\n      this.dispatchEvent(new CustomEvent('change', { detail: { value: this.editor.value } }));\n    });\n\n    this.editor.addEventListener('keydown', (e) => {\n      this.handleKeyDown(e);\n    });\n\n    this.editor.addEventListener('keyup', (e) => {\n      if (this.isShowingSuggestion && ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End'].includes(e.key)) {\n        this.hideSuggestion();\n      }\n      // Update background on cursor movement, after potentially hiding suggestion\n      if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End'].includes(e.key)) {\n        this.updateBackground();\n      }\n    });\n\n    this.editor.addEventListener('click', () => {\n      if (this.isShowingSuggestion) {\n        this.hideSuggestion();\n      }\n      // Update background on mouse click (cursor position change)\n      // setTimeout ensures cursor position is updated before background redraw\n      setTimeout(() => this.updateBackground(), 0);\n    });\n\n    this.editor.addEventListener('scroll', () => {\n      this.syncScroll();\n    });\n\n    this._loadApiKey();\n    this._loadSettings();\n    this.updateBackground();\n  }\n\n  /**\n   * Updates the background layer with current text and suggestions\n   */\n  private updateBackground(): void {\n    const currentText = this.editor.value;\n    const cursorPosition = this.editor.selectionStart;\n\n    let finalHtmlContent = '';\n\n    if (this.isShowingSuggestion && this.fullSuggestion) {\n      const beforeCursorText = currentText.substring(0, cursorPosition);\n      const afterCursorText = currentText.substring(cursorPosition);\n\n      // Determine the pending (not yet accepted) part of the suggestion\n      const pendingParagraphs = Array.isArray(this.suggestionParagraphs)\n        ? this.suggestionParagraphs.slice(this.currentParagraphIndex)\n        : [];\n      const pendingSuggestionText = pendingParagraphs.join(' ');\n\n      if (pendingSuggestionText.trim().length > 0) {\n        const mainSpacer = (beforeCursorText.endsWith(' ') || beforeCursorText === '' || pendingSuggestionText.startsWith(' ') || pendingSuggestionText === '') ? '' : ' ';\n        const suggestionBlockHtml = `<span class=\"suggestion-text\">${this.escapeHtml(pendingSuggestionText)}</span>`;\n\n        finalHtmlContent =\n          this.escapeHtml(beforeCursorText).replace(/\\n/g, '<br>') +\n          mainSpacer +\n          suggestionBlockHtml +\n          this.escapeHtml(afterCursorText).replace(/\\n/g, '<br>');\n      } else {\n        finalHtmlContent = this.escapeHtml(currentText).replace(/\\n/g, '<br>');\n      }\n    } else {\n      finalHtmlContent = this.escapeHtml(currentText).replace(/\\n/g, '<br>');\n    }\n\n    this.editorBackground.innerHTML = finalHtmlContent;\n    this.syncScroll();\n  }\n\n  /**\n   * Synchronizes scroll position between editor and background\n   */\n  private syncScroll(): void {\n    this.editorBackground.scrollTop = this.editor.scrollTop;\n    this.editorBackground.scrollLeft = this.editor.scrollLeft;\n  }\n\n  /**\n   * Handles text input events\n   */\n  private handleTextInput(): void {\n    this.hideSuggestion();\n\n    if (this.typingTimer) {\n      clearTimeout(this.typingTimer);\n    }\n\n    if (!this.apiKey) return;\n\n    this.typingTimer = window.setTimeout(() => {\n      this.requestSuggestion();\n    }, this.suggestionDelay);\n  }\n\n  /**\n   * Handles keyboard events\n   */\n  private handleKeyDown(e: KeyboardEvent): void {\n    if (this.isShowingSuggestion) {\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        this.acceptSuggestion();\n      } else if (e.key === 'Escape') {\n        e.preventDefault();\n        this.hideSuggestion();\n      }\n    }\n  }\n\n  /**\n   * Requests an AI suggestion for the current text\n   */\n  private async requestSuggestion(): Promise<void> {\n    if (!this.apiKey) return;\n\n    const currentText = this.editor.value;\n    if (!currentText.trim()) return;\n\n    // Get text up to cursor position for context\n    const cursorPosition = this.editor.selectionStart;\n    const textUpToCursor = currentText.substring(0, cursorPosition);\n\n    // Dispatch an event before starting the AI request, allow listeners to cancel\n    const proceed = this.dispatchEvent(new CustomEvent('beforeSuggestion', {\n      detail: {\n        text: textUpToCursor,\n        context: this.context,\n        apiEndpoint: this.apiEndpoint,\n        modelName: this.modelName,\n        systemPrompt: this.systemPrompt\n      },\n      cancelable: true\n    }));\n\n    if (proceed === false) {\n      return; // aborted by listener via event.preventDefault()\n    }\n\n    this.showLoading();\n\n    try {\n      const suggestion = await this.callOpenAI(textUpToCursor);\n      this.hideLoading();\n\n      if (suggestion) {\n        this.showSuggestion(suggestion);\n      }\n    } catch (error) {\n      this.hideLoading();\n      this.showError('Failed to get AI suggestion: ' + (error as Error).message);\n      this.dispatchEvent(new CustomEvent('oncompletionerror', {\n        detail: { error: (error as Error).message },\n        bubbles: true,\n        composed: true\n      }));\n    }\n  }\n\n  /**\n   * Calls the OpenAI API for text completion\n   */\n  private async callOpenAI(text: string): Promise<string> {\n    const parts: string[] = [];\n    if (this.context && this.context.trim()) {\n      parts.push(`Context:\\n${this.context.trim()}`);\n    }\n    parts.push(`Please continue this text naturally:\\n\\n${text}`);\n    const userContent = parts.join('\\n\\n');\n\n    // Prepare headers - only add Authorization if API key is provided\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json'\n    };\n\n    if (this.apiKey && this.apiKey.trim() !== '') {\n      headers['Authorization'] = `Bearer ${this.apiKey}`;\n    }\n\n    const requestBody = {\n      model: this.modelName,\n      messages: [\n        {\n          role: 'system',\n          content: this.systemPrompt\n        },\n        {\n          role: 'user',\n          content: userContent\n        }\n      ],\n      max_tokens: 150,\n      temperature: 0.7\n    };\n\n    const response = await fetch(this.apiEndpoint, {\n      method: 'POST',\n      headers: headers,\n      body: JSON.stringify(requestBody)\n    });\n\n    if (!response.ok) {\n      let errorMessage = 'API request failed';\n      try {\n        const errorData = await response.json();\n        errorMessage = errorData.error?.message || errorMessage;\n      } catch (parseError) {\n        console.error('Failed to parse error response:', parseError);\n        errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n      }\n      throw new Error(errorMessage);\n    }\n\n    const data = await response.json();\n    return data.choices[0]?.message?.content?.trim();\n  }\n\n  /**\n   * Shows an AI suggestion\n   */\n  private showSuggestion(suggestion: string): void {\n    this.fullSuggestion = suggestion;\n    this.suggestionParagraphs = this.splitIntoParagraphs(suggestion);\n    this.currentParagraphIndex = 0;\n    this.isShowingSuggestion = true;\n    this.updateBackground();\n  }\n\n  /**\n   * Splits text into paragraphs/sentences\n   */\n  private splitIntoParagraphs(text: string): string[] {\n    // Split on periods followed by space and capital letter, or double newlines\n    const sentences = text.split(/(?<=\\.)\\s+(?=[A-Z])|(?:\\n\\s*\\n)/);\n    return sentences.filter(sentence => sentence.trim().length > 0);\n  }\n\n  /**\n   * Hides the current suggestion\n   */\n  private hideSuggestion(): void {\n    this.isShowingSuggestion = false;\n    this.fullSuggestion = null;\n    this.suggestionParagraphs = [];\n    this.currentParagraphIndex = 0;\n    this.updateBackground();\n  }\n\n  /**\n   * Accepts the current suggestion paragraph\n   */\n  private acceptSuggestion(): void {\n    if (this.fullSuggestion && this.currentParagraphIndex < this.suggestionParagraphs.length) {\n      const currentText = this.editor.value;\n      const cursorPosition = this.editor.selectionStart;\n      const paragraphToAdd = this.suggestionParagraphs[this.currentParagraphIndex];\n\n      // Insert at cursor position\n      const beforeCursor = currentText.substring(0, cursorPosition);\n      const afterCursor = currentText.substring(cursorPosition);\n\n      // Refined spacer logic\n      const spacer = (beforeCursor.endsWith(' ') || beforeCursor === '' || paragraphToAdd.startsWith(' ') || paragraphToAdd === '') ? '' : ' ';\n      const newText = beforeCursor + spacer + paragraphToAdd + afterCursor;\n\n      this.editor.value = newText;\n\n      // Update cursor position to after the inserted text\n      const newCursorPosition = cursorPosition + spacer.length + paragraphToAdd.length;\n      this.editor.setSelectionRange(newCursorPosition, newCursorPosition);\n      this.dispatchEvent(new CustomEvent('change', { detail: { value: this.editor.value } }));\n\n      // Move to next paragraph or hide if no more paragraphs\n      this.currentParagraphIndex++;\n      if (this.currentParagraphIndex >= this.suggestionParagraphs.length) {\n        this.hideSuggestion();\n      } else {\n        this.updateBackground();\n      }\n    }\n  }\n\n  /**\n   * Shows loading indicator\n   */\n  private showLoading(): void {\n    this.loading.classList.add('show');\n    if (this.onLoadingChangeCallback) {\n      this.onLoadingChangeCallback(true);\n    }\n  }\n\n  /**\n   * Hides loading indicator\n   */\n  private hideLoading(): void {\n    this.loading.classList.remove('show');\n    if (this.onLoadingChangeCallback) {\n      this.onLoadingChangeCallback(false);\n    }\n  }\n\n  /**\n   * Shows an error message\n   */\n  private showError(message: string): void {\n    console.error('AI Text Editor Error:', message);\n    // Try to dispatch a custom error event that can be handled by parent\n    this.dispatchEvent(new CustomEvent('error', {\n      detail: { message },\n      bubbles: true,\n      composed: true\n    }));\n  }\n\n  /**\n   * Escapes HTML special characters\n   */\n  private escapeHtml(unsafe: any): string {\n    if (typeof unsafe !== 'string') {\n      if (unsafe === null || typeof unsafe === 'undefined') {\n        return '';\n      }\n      unsafe = String(unsafe);\n    }\n    return unsafe\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&#039;\");\n  }\n\n  /**\n   * Sets the text content\n   */\n  setText(text: string): void {\n    this.editor.value = text;\n    this.dispatchEvent(new CustomEvent('change', { detail: { value: this.editor.value } }));\n    this.hideSuggestion();\n    this.updateBackground();\n  }\n\n  /**\n   * Gets the text content\n   */\n  getText(): string {\n    return this.editor.value;\n  }\n\n  /**\n   * Sets the API key\n   */\n  setApiKey(key: string): void {\n    this.apiKey = key;\n    this._saveApiKey();\n    this.editorStatus.style.backgroundColor = this.apiKey ? '#4caf50' : '#777';\n    if (this.onStatusChangeCallback) {\n      this.onStatusChangeCallback(!!this.apiKey);\n    }\n  }\n\n  /**\n   * Saves API key to localStorage\n   */\n  private _saveApiKey(): void {\n    if (!this.apiKey) {\n      localStorage.removeItem(AI_TEXT_EDITOR_API_KEY);\n      return;\n    }\n\n    // Encrypt the API key in base64 format\n    const encryptedKey = btoa(this.apiKey);\n    localStorage.setItem(AI_TEXT_EDITOR_API_KEY, encryptedKey);\n  }\n\n  /**\n   * Loads API key from localStorage\n   */\n  private _loadApiKey(): void {\n    const savedKey = localStorage.getItem(AI_TEXT_EDITOR_API_KEY);\n    if (!savedKey) {\n      this.setApiKey('');\n      return;\n    }\n\n    const decryptedKey = atob(savedKey);\n    this.setApiKey(decryptedKey);\n  }\n\n  /**\n   * Gets the API key\n   */\n  getApiKey(): string {\n    return this.apiKey;\n  }\n\n  /**\n   * Sets the suggestion delay in seconds\n   */\n  setSuggestionDelay(seconds: number): void {\n    this.suggestionDelay = seconds * 1000;\n  }\n\n  /**\n   * Gets the suggestion delay in seconds\n   */\n  getSuggestionDelay(): number {\n    return this.suggestionDelay / 1000;\n  }\n\n  /**\n   * Sets the system prompt\n   */\n  setSystemPrompt(prompt: string): void {\n    this.systemPrompt = prompt;\n  }\n\n  /**\n   * Gets the system prompt\n   */\n  getSystemPrompt(): string {\n    return this.systemPrompt;\n  }\n\n  /**\n   * Sets the API endpoint\n   */\n  setApiEndpoint(endpoint: string): void {\n    this.apiEndpoint = endpoint;\n    this._saveSettings();\n  }\n\n  /**\n   * Gets the API endpoint\n   */\n  getApiEndpoint(): string {\n    return this.apiEndpoint;\n  }\n\n  /**\n   * Sets the model name\n   */\n  setModelName(modelName: string): void {\n    this.modelName = modelName;\n    this._saveSettings();\n  }\n\n  /**\n   * Gets the model name\n   */\n  getModelName(): string {\n    return this.modelName;\n  }\n\n  /**\n   * Sets the context\n   */\n  setContext(context: string): void {\n    this.context = typeof context === 'string' ? context : '';\n  }\n\n  /**\n   * Gets the context\n   */\n  getContext(): string {\n    return this.context;\n  }\n\n  /**\n   * Configure the editor with callbacks and embedded mode\n   */\n  configure(config: Partial<AITextEditorConfig>): void {\n    if (config.embedded !== undefined) {\n      this.embedded = config.embedded;\n      if (this.embedded) {\n        this.setAttribute('embedded', '');\n      } else {\n        this.removeAttribute('embedded');\n      }\n    }\n    \n    if (config.onStatusChange) {\n      this.onStatusChangeCallback = config.onStatusChange;\n      // Immediately call with current status\n      this.onStatusChangeCallback(!!this.apiKey);\n    }\n    \n    if (config.onLoadingChange) {\n      this.onLoadingChangeCallback = config.onLoadingChange;\n    }\n    \n    if (config.apiKey !== undefined) {\n      this.setApiKey(config.apiKey);\n    }\n    \n    if (config.suggestionDelay !== undefined) {\n      this.setSuggestionDelay(config.suggestionDelay);\n    }\n    \n    if (config.systemPrompt !== undefined) {\n      this.setSystemPrompt(config.systemPrompt);\n    }\n    \n    if (config.apiEndpoint !== undefined) {\n      this.setApiEndpoint(config.apiEndpoint);\n    }\n    \n    if (config.modelName !== undefined) {\n      this.setModelName(config.modelName);\n    }\n    \n    if (config.context !== undefined) {\n      this.setContext(config.context);\n    }\n  }\n\n  /**\n   * Saves settings to localStorage\n   */\n  private _saveSettings(): void {\n    const settings = {\n      apiEndpoint: this.apiEndpoint,\n      modelName: this.modelName\n    };\n    localStorage.setItem('ai-text-editor-settings', JSON.stringify(settings));\n  }\n\n  /**\n   * Loads settings from localStorage\n   */\n  private _loadSettings(): void {\n    const savedSettings = localStorage.getItem('ai-text-editor-settings');\n    if (savedSettings) {\n      try {\n        const settings = JSON.parse(savedSettings);\n        if (settings.apiEndpoint) {\n          this.apiEndpoint = settings.apiEndpoint;\n        }\n        if (settings.modelName) {\n          this.modelName = settings.modelName;\n        }\n      } catch (error) {\n        console.warn('Failed to load saved settings:', error);\n      }\n    }\n  }\n}\n\n/**\n * Conditionally defines the custom element if in a browser environment.\n */\nconst defineAITextEditor = (tagName: string = 'liwe3-ai-text-editor'): void => {\n  if (typeof window !== 'undefined' && !window.customElements.get(tagName)) {\n    customElements.define(tagName, AITextEditorElement);\n  }\n};\n\n// Auto-register with default tag name\ndefineAITextEditor();\n\nexport { defineAITextEditor };\n"],"names":["AI_TEXT_EDITOR_API_KEY","AITextEditorElement","editor","editorBackground","loading","e","currentText","cursorPosition","finalHtmlContent","beforeCursorText","afterCursorText","pendingSuggestionText","mainSpacer","suggestionBlockHtml","textUpToCursor","suggestion","error","text","parts","userContent","headers","requestBody","response","errorMessage","parseError","sentence","paragraphToAdd","beforeCursor","afterCursor","spacer","newText","newCursorPosition","message","unsafe","key","encryptedKey","savedKey","decryptedKey","seconds","prompt","endpoint","modelName","context","config","settings","savedSettings","defineAITextEditor","tagName"],"mappings":"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"}