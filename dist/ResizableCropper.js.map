{"version":3,"file":"ResizableCropper.js","sources":["../src/ResizableCropper.ts"],"sourcesContent":["/**\n * ResizableCropper Web Component\n * A container that wraps a single child element with drag-to-scale (resizing) and drag-to-crop (panning) capabilities\n */\n\nexport interface ResizableCropperState {\n\twidth : number;\n\theight : number;\n\tminWidth : number;\n\tminHeight : number;\n\taspectRatio : string | null;\n\tcontentElement : HTMLElement | null;\n\tcontentLeft : number;\n\tcontentTop : number;\n\trotation : number;\n\twrapperLeft : number;\n\twrapperTop : number;\n}\n\nexport interface ResizableCropperValues {\n\twrapperWidth : number;\n\twrapperHeight : number;\n\twrapperLeft : number;\n\twrapperTop : number;\n\tcontentWidth : number;\n\tcontentHeight : number;\n\tcontentLeft : number;\n\tcontentTop : number;\n\tzoom : number;\n\trotation : number;\n}\n\nexport interface ResizableCropperComponentState {\n\tmode : 'transform' | 'crop';\n\tdisabled : boolean;\n\tallowCrop : boolean;\n\tallowResize : boolean;\n\tallowRotate : boolean;\n\tallowDrag : boolean;\n\tminWidth : number;\n\tminHeight : number;\n\taspectRatio : string | null;\n\tvalues : ResizableCropperValues;\n}\n\nexport interface ResizableCropEventDetail {\n\twidth : number;\n\theight : number;\n\twrapperLeft : number;\n\twrapperTop : number;\n\tcontentLeft : number;\n\tcontentTop : number;\n\taction : 'scale' | 'crop' | 'pan' | 'rotate' | 'move';\n\trotation? : number;\n\thandle? : string;\n}\n\nexport class ResizableCropperElement extends HTMLElement {\n\tdeclare shadowRoot : ShadowRoot;\n\n\tprivate state : ResizableCropperState = {\n\t\twidth: 200,\n\t\theight: 150,\n\t\tminWidth: 50,\n\t\tminHeight: 50,\n\t\taspectRatio: null,\n\t\tcontentElement: null,\n\t\tcontentLeft: 0,\n\t\tcontentTop: 0,\n\t\trotation: 0,\n\t\twrapperLeft: 0,\n\t\twrapperTop: 0,\n\t};\n\n\tprivate wrapper! : HTMLElement;\n\tprivate contentSlot! : HTMLSlotElement;\n\tprivate handlesContainer! : HTMLElement;\n\n\tprivate isDragging = false;\n\tprivate dragAction : 'scale' | 'crop' | 'pan' | 'rotate' | 'move' | null = null;\n\tprivate dragHandle : string | null = null;\n\tprivate dragStartX = 0;\n\tprivate dragStartY = 0;\n\tprivate dragStartWidth = 0;\n\tprivate dragStartHeight = 0;\n\tprivate dragStartContentLeft = 0;\n\tprivate dragStartContentTop = 0;\n\tprivate dragStartContentWidth = 0;\n\tprivate dragStartContentHeight = 0;\n\tprivate initialContentWidth = 0;\n\tprivate initialContentHeight = 0;\n\tprivate _dragStartRotation = 0;\n\tprivate _dragStartPointerAngle = 0;\n\tprivate _dragRotateCenterX = 0;\n\tprivate _dragRotateCenterY = 0;\n\tprivate _interactionMode : 'transform' | 'crop' = 'transform';\n\tprivate _dragPointerOffsetX = 0;\n\tprivate _dragPointerOffsetY = 0;\n\tprivate _dragMoveContainer : HTMLElement | null = null;\n\n\tconstructor () {\n\t\tsuper();\n\t\tthis.attachShadow( { mode: 'open' } );\n\t\tthis.render();\n\t}\n\n\tstatic get observedAttributes () : string[] {\n\t\treturn [ 'width', 'height', 'min-width', 'min-height', 'aspect-ratio', 'disabled', 'allow-crop', 'allow-resize', 'allow-rotate', 'allow-drag' ];\n\t}\n\n\tattributeChangedCallback ( name : string, oldValue : string | null, newValue : string | null ) : void {\n\t\tif ( oldValue === newValue ) return;\n\n\t\tswitch ( name ) {\n\t\t\tcase 'width':\n\t\t\t\tthis.state.width = parseFloat( newValue || '200' );\n\t\t\t\tthis.updateWrapperDimensions();\n\t\t\t\tbreak;\n\t\t\tcase 'height':\n\t\t\t\tthis.state.height = parseFloat( newValue || '150' );\n\t\t\t\tthis.updateWrapperDimensions();\n\t\t\t\tbreak;\n\t\t\tcase 'min-width':\n\t\t\t\tthis.state.minWidth = parseFloat( newValue || '50' );\n\t\t\t\tbreak;\n\t\t\tcase 'min-height':\n\t\t\t\tthis.state.minHeight = parseFloat( newValue || '50' );\n\t\t\t\tbreak;\n\t\t\tcase 'aspect-ratio':\n\t\t\t\tthis.state.aspectRatio = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'allow-crop':\n\t\t\tcase 'allow-resize':\n\t\t\tcase 'allow-rotate':\n\t\t\tcase 'allow-drag':\n\t\t\t\tthis.updateHandlesVisibility();\n\t\t\t\tthis._applyInteractionModeUI();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconnectedCallback () : void {\n\t\tthis.wrapper = this.shadowRoot.querySelector( '#wrapper' )!;\n\t\tthis.shadowRoot.querySelector( '#clipper' )!;\n\t\tthis.contentSlot = this.shadowRoot.querySelector( 'slot' )!;\n\t\tthis.handlesContainer = this.shadowRoot.querySelector( '#handles-container' )!;\n\n\t\tthis.updateWrapperDimensions();\n\t\tthis.updateHandlesVisibility();\n\t\tthis._applyInteractionModeUI();\n\t\tthis._syncWrapperPositionFromLayout( this._getContainerForMove() );\n\t\tthis.bindEvents();\n\n\t\tthis.contentSlot.addEventListener( 'slotchange', () => {\n\t\t\tthis.updateContentElement();\n\t\t} );\n\n\t\tthis.updateContentElement();\n\t}\n\n\tdisconnectedCallback () : void {\n\t\tthis.unbindEvents();\n\t}\n\n\tprivate _applyInteractionModeUI () : void {\n\t\tif ( !this.wrapper ) return;\n\t\tthis.wrapper.style.cursor = this._interactionMode === 'transform' && this.allowDrag && !this.disabled ? 'move' : '';\n\t}\n\n\tprivate _setInteractionMode ( mode : 'transform' | 'crop' ) : void {\n\t\tif ( this._interactionMode === mode ) return;\n\t\tthis._interactionMode = mode;\n\t\tthis.updateHandlesVisibility();\n\t\tthis._applyInteractionModeUI();\n\t}\n\n\tprivate updateContentElement () : void {\n\t\tconst nodes = this.contentSlot.assignedElements();\n\t\tif ( nodes.length > 0 ) {\n\t\t\tthis.state.contentElement = nodes[0] as HTMLElement;\n\t\t\tthis.state.contentElement.style.position = 'absolute';\n\t\t\tthis.state.contentElement.style.left = `${this.state.contentLeft}px`;\n\t\t\tthis.state.contentElement.style.top = `${this.state.contentTop}px`;\n\n\t\t\t// Get initial content dimensions\n\t\t\tif ( this.state.contentElement instanceof HTMLImageElement ) {\n\t\t\t\tif ( this.state.contentElement.complete ) {\n\t\t\t\t\tthis.initializeContentSize();\n\t\t\t\t} else {\n\t\t\t\t\tthis.state.contentElement.addEventListener( 'load', () => {\n\t\t\t\t\t\tthis.initializeContentSize();\n\t\t\t\t\t}, { once: true } );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initializeContentSize () : void {\n\t\tif ( !this.state.contentElement ) return;\n\t\tconst width = this.state.contentElement.offsetWidth;\n\t\tconst height = this.state.contentElement.offsetHeight;\n\t\tif ( width > 0 ) {\n\t\t\tthis.state.contentElement.style.width = `${width}px`;\n\t\t\tthis.state.contentElement.style.height = 'auto';\n\t\t\tthis.initialContentWidth = width;\n\t\t\tthis.initialContentHeight = height;\n\t\t}\n\t}\n\n\tprivate updateWrapperDimensions () : void {\n\t\tif ( !this.wrapper ) return;\n\t\tthis.wrapper.style.width = `${this.state.width}px`;\n\t\tthis.wrapper.style.height = `${this.state.height}px`;\n\t\tthis._applyWrapperTransform();\n\t}\n\n\tprivate _applyWrapperTransform () : void {\n\t\tif ( !this.wrapper ) return;\n\t\tthis.wrapper.style.transformOrigin = 'center center';\n\t\tthis.wrapper.style.transform = `rotate(${this.state.rotation}deg)`;\n\t}\n\n\tprivate updateHandlesVisibility () : void {\n\t\tif ( !this.handlesContainer ) return;\n\n\t\tconst scaleHandle = this.handlesContainer.querySelector( '[data-action=\"scale\"]' ) as HTMLElement;\n\t\tconst rotateHandle = this.handlesContainer.querySelector( '[data-action=\"rotate\"]' ) as HTMLElement;\n\t\tconst cropHandles = this.handlesContainer.querySelectorAll( '[data-action=\"crop\"]' );\n\n\t\tif ( scaleHandle ) {\n\t\t\tscaleHandle.style.display = this.allowResize ? '' : 'none';\n\t\t}\n\n\t\tif ( rotateHandle ) {\n\t\t\trotateHandle.style.display = this.allowRotate ? '' : 'none';\n\t\t}\n\n\t\tcropHandles.forEach( ( handle ) => {\n\t\t\t( handle as HTMLElement ).style.display = this.allowCrop && this._interactionMode === 'crop' ? '' : 'none';\n\t\t} );\n\t}\n\n\tprivate bindEvents () : void {\n\t\tthis.handlesContainer.addEventListener( 'pointerdown', this.handlePointerDown );\n\t\tthis.wrapper.addEventListener( 'pointerdown', this.handleWrapperPointerDown );\n\t\tthis.wrapper.addEventListener( 'dblclick', this.handleWrapperDoubleClick );\n\t\tdocument.addEventListener( 'pointerdown', this.handleDocumentPointerDown, true );\n\n\t\t// Add listener for dragging the content/image itself\n\t\tthis.contentSlot.addEventListener( 'slotchange', () => {\n\t\t\tconst elements = this.contentSlot.assignedElements();\n\t\t\tif ( elements.length > 0 ) {\n\t\t\t\tconst content = elements[0] as HTMLElement;\n\t\t\t\tcontent.addEventListener( 'pointerdown', this.handleContentPointerDown );\n\t\t\t}\n\t\t} );\n\t}\n\n\tprivate unbindEvents () : void {\n\t\tthis.handlesContainer.removeEventListener( 'pointerdown', this.handlePointerDown );\n\t\tthis.wrapper.removeEventListener( 'pointerdown', this.handleWrapperPointerDown );\n\t\tthis.wrapper.removeEventListener( 'dblclick', this.handleWrapperDoubleClick );\n\t\tdocument.removeEventListener( 'pointerdown', this.handleDocumentPointerDown, true );\n\n\t\tconst elements = this.contentSlot.assignedElements();\n\t\tif ( elements.length > 0 ) {\n\t\t\tconst content = elements[0] as HTMLElement;\n\t\t\tcontent.removeEventListener( 'pointerdown', this.handleContentPointerDown );\n\t\t}\n\t}\n\n\tprivate handleWrapperDoubleClick = ( event : MouseEvent ) : void => {\n\t\tif ( this.disabled ) return;\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis._setInteractionMode( 'crop' );\n\t};\n\n\tprivate handleDocumentPointerDown = ( event : PointerEvent ) : void => {\n\t\tif ( this._interactionMode !== 'crop' ) return;\n\t\tconst path = event.composedPath();\n\t\tif ( path.includes( this ) ) return;\n\t\tthis._setInteractionMode( 'transform' );\n\t};\n\n\tprivate _getContainerForMove () : HTMLElement {\n\t\treturn this.parentElement || ( this.offsetParent as HTMLElement ) || document.body;\n\t}\n\n\tprivate _ensureContainerPositionedForMove ( container : HTMLElement ) : void {\n\t\tconst computed = window.getComputedStyle( container );\n\t\tif ( computed.position !== 'static' ) return;\n\t\tcontainer.style.position = 'relative';\n\t}\n\n\tprivate _syncWrapperPositionFromLayout ( container : HTMLElement ) : void {\n\t\tconst containerRect = container.getBoundingClientRect();\n\t\tconst hostRect = this.getBoundingClientRect();\n\t\tconst scrollLeft = container.scrollLeft;\n\t\tconst scrollTop = container.scrollTop;\n\t\tconst originLeft = containerRect.left + container.clientLeft;\n\t\tconst originTop = containerRect.top + container.clientTop;\n\t\tthis.state.wrapperLeft = hostRect.left - originLeft + scrollLeft;\n\t\tthis.state.wrapperTop = hostRect.top - originTop + scrollTop;\n\t}\n\n\tprivate _ensureAbsolutePositionForMove ( container : HTMLElement ) : void {\n\t\tthis._ensureContainerPositionedForMove( container );\n\t\tthis._syncWrapperPositionFromLayout( container );\n\t\tthis.style.position = 'absolute';\n\t\tthis.style.left = `${this.state.wrapperLeft}px`;\n\t\tthis.style.top = `${this.state.wrapperTop}px`;\n\t\tthis.style.touchAction = 'none';\n\t}\n\n\tprivate handleWrapperPointerDown = ( event : PointerEvent ) : void => {\n\t\tif ( this.disabled ) return;\n\t\tif ( !this.allowDrag ) return;\n\t\tif ( this._interactionMode !== 'transform' ) return;\n\n\t\tconst target = event.target as HTMLElement;\n\t\tif ( target.closest( '[data-action]' ) ) return;\n\n\t\t// In transform mode, dragging anywhere moves the whole component\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst container = this._getContainerForMove();\n\t\tthis._dragMoveContainer = container;\n\t\tthis._ensureAbsolutePositionForMove( container );\n\t\tthis._syncWrapperPositionFromLayout( container );\n\n\t\tconst hostRect = this.getBoundingClientRect();\n\t\tthis._dragPointerOffsetX = event.clientX - hostRect.left;\n\t\tthis._dragPointerOffsetY = event.clientY - hostRect.top;\n\n\t\tthis.isDragging = true;\n\t\tthis.dragAction = 'move';\n\t\tthis.dragHandle = null;\n\t\tthis.dragStartX = event.clientX;\n\t\tthis.dragStartY = event.clientY;\n\n\t\tdocument.addEventListener( 'pointermove', this.handlePointerMove );\n\t\tdocument.addEventListener( 'pointerup', this.handlePointerUp );\n\t\tthis.dispatchEvent( new CustomEvent( 'rcw:move-start', { detail: { action: 'move' } } ) );\n\t};\n\n\tprivate handlePointerDown = ( event : PointerEvent ) : void => {\n\t\tif ( this.disabled ) return;\n\n\t\tconst target = event.target as HTMLElement;\n\t\tconst handle = target.closest( '[data-action]' ) as HTMLElement;\n\t\tif ( !handle ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.dragAction = handle.dataset.action as 'scale' | 'crop' | 'rotate';\n\t\tif ( this.dragAction === 'crop' && this._interactionMode !== 'crop' ) return;\n\t\tif ( this.dragAction === 'rotate' && !this.allowRotate ) return;\n\t\tthis.isDragging = true;\n\t\tthis.dragHandle = handle.dataset.corner || handle.dataset.side || null;\n\t\tthis.dragStartX = event.clientX;\n\t\tthis.dragStartY = event.clientY;\n\t\tthis.dragStartWidth = this.state.width;\n\t\tthis.dragStartHeight = this.state.height;\n\t\tthis.dragStartContentLeft = this.state.contentLeft;\n\t\tthis.dragStartContentTop = this.state.contentTop;\n\n\t\t// Get current content dimensions (ignore transforms)\n\t\tif ( this.state.contentElement ) {\n\t\t\tthis.dragStartContentWidth = this.state.contentElement.offsetWidth;\n\t\t\tthis.dragStartContentHeight = this.state.contentElement.offsetHeight;\n\t\t}\n\n\t\tif ( this.dragAction === 'rotate' ) {\n\t\t\tconst wrapperRect = this.wrapper.getBoundingClientRect();\n\t\t\tthis._dragRotateCenterX = wrapperRect.left + wrapperRect.width / 2;\n\t\t\tthis._dragRotateCenterY = wrapperRect.top + wrapperRect.height / 2;\n\t\t\tthis._dragStartPointerAngle = Math.atan2( event.clientY - this._dragRotateCenterY, event.clientX - this._dragRotateCenterX );\n\t\t\tthis._dragStartRotation = this.state.rotation;\n\t\t}\n\n\t\tdocument.addEventListener( 'pointermove', this.handlePointerMove );\n\t\tdocument.addEventListener( 'pointerup', this.handlePointerUp );\n\n\t\tconst eventName = this.dragAction === 'scale'\n\t\t\t? 'rcw:scale-start'\n\t\t\t: this.dragAction === 'crop'\n\t\t\t? 'rcw:crop-start'\n\t\t\t: 'rcw:rotate-start';\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent( eventName, {\n\t\t\t\tdetail: { action: this.dragAction, handle: this.dragHandle },\n\t\t\t} ),\n\t\t);\n\t};\n\n\tprivate handleContentPointerDown = ( event : PointerEvent ) : void => {\n\t\tif ( this.disabled ) return;\n\t\tif ( this._interactionMode !== 'crop' ) return;\n\n\t\t// Only allow panning if content is larger than wrapper\n\t\tif ( !this.state.contentElement ) return;\n\n\t\t// Check if content is larger than wrapper in either dimension (ignore transforms)\n\t\tconst canPan = this.state.contentElement.offsetWidth > this.state.width || this.state.contentElement.offsetHeight > this.state.height;\n\t\tif ( !canPan ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.isDragging = true;\n\t\tthis.dragAction = 'pan';\n\t\tthis.dragHandle = null;\n\t\tthis.dragStartX = event.clientX;\n\t\tthis.dragStartY = event.clientY;\n\t\tthis.dragStartContentLeft = this.state.contentLeft;\n\t\tthis.dragStartContentTop = this.state.contentTop;\n\n\t\tdocument.addEventListener( 'pointermove', this.handlePointerMove );\n\t\tdocument.addEventListener( 'pointerup', this.handlePointerUp );\n\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent( 'rcw:pan-start', {\n\t\t\t\tdetail: { action: 'pan' },\n\t\t\t} ),\n\t\t);\n\t};\n\n\tprivate handlePointerMove = ( event : PointerEvent ) : void => {\n\t\tif ( !this.isDragging ) return;\n\t\tif ( this.dragAction === 'move' ) {\n\t\t\tconst container = this._dragMoveContainer || this._getContainerForMove();\n\t\t\tconst containerRect = container.getBoundingClientRect();\n\t\t\tconst originLeft = containerRect.left + container.clientLeft;\n\t\t\tconst originTop = containerRect.top + container.clientTop;\n\t\t\tthis.state.wrapperLeft = event.clientX - originLeft + container.scrollLeft - this._dragPointerOffsetX;\n\t\t\tthis.state.wrapperTop = event.clientY - originTop + container.scrollTop - this._dragPointerOffsetY;\n\t\t\tthis.style.left = `${this.state.wrapperLeft}px`;\n\t\t\tthis.style.top = `${this.state.wrapperTop}px`;\n\t\t\tthis.dispatchChange( 'move' );\n\t\t\treturn;\n\t\t}\n\t\tif ( this.dragAction === 'rotate' ) {\n\t\t\tthis.handleRotate( event.clientX, event.clientY );\n\t\t\tthis.dispatchChange( 'rotate' );\n\t\t\treturn;\n\t\t}\n\n\t\tconst deltaX = event.clientX - this.dragStartX;\n\t\tconst deltaY = event.clientY - this.dragStartY;\n\n\t\tif ( this.dragAction === 'scale' ) {\n\t\t\tthis.handleScale( deltaX, deltaY, this.dragHandle! );\n\t\t} else if ( this.dragAction === 'crop' ) {\n\t\t\tthis.handleCrop( deltaX, deltaY, this.dragHandle! );\n\t\t} else if ( this.dragAction === 'pan' ) {\n\t\t\tthis.handlePan( deltaX, deltaY );\n\t\t}\n\n\t\tthis.dispatchChange( this.dragAction! );\n\t};\n\tprivate handleRotate ( pointerX : number, pointerY : number ) : void {\n\t\tconst pointerAngle = Math.atan2( pointerY - this._dragRotateCenterY, pointerX - this._dragRotateCenterX );\n\t\tconst deltaAngle = pointerAngle - this._dragStartPointerAngle;\n\t\tconst deltaDegrees = deltaAngle * ( 180 / Math.PI );\n\t\tthis.state.rotation = this._dragStartRotation + deltaDegrees;\n\t\tthis._applyWrapperTransform();\n\t}\n\n\tprivate handlePointerUp = () : void => {\n\t\tif ( !this.isDragging ) return;\n\n\t\tthis.isDragging = false;\n\t\tdocument.removeEventListener( 'pointermove', this.handlePointerMove );\n\t\tdocument.removeEventListener( 'pointerup', this.handlePointerUp );\n\n\t\tif ( this.dragAction ) {\n\t\t\tthis.dispatchChange( this.dragAction );\n\t\t}\n\n\t\tthis.dragAction = null;\n\t\tthis.dragHandle = null;\n\t\tthis._dragMoveContainer = null;\n\t};\n\n\tprivate handleScale ( deltaX : number, deltaY : number, handleCorner : string ) : void {\n\t\tif ( !this.state.contentElement ) return;\n\n\t\tlet newWidth = this.dragStartWidth;\n\t\tlet newHeight = this.dragStartHeight;\n\n\t\t// Scale both the wrapper AND the content together\n\t\tswitch ( handleCorner ) {\n\t\t\tcase 'br': // Bottom-right\n\t\t\t\tnewWidth = this.dragStartWidth + deltaX;\n\t\t\t\tnewHeight = this.dragStartHeight + deltaY;\n\t\t\t\tbreak;\n\t\t\tcase 'bl': // Bottom-left\n\t\t\t\tnewWidth = this.dragStartWidth - deltaX;\n\t\t\t\tnewHeight = this.dragStartHeight + deltaY;\n\t\t\t\tbreak;\n\t\t\tcase 'tr': // Top-right\n\t\t\t\tnewWidth = this.dragStartWidth + deltaX;\n\t\t\t\tnewHeight = this.dragStartHeight - deltaY;\n\t\t\t\tbreak;\n\t\t\tcase 'tl': // Top-left\n\t\t\t\tnewWidth = this.dragStartWidth - deltaX;\n\t\t\t\tnewHeight = this.dragStartHeight - deltaY;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Apply minimum constraints\n\t\tnewWidth = Math.max( this.state.minWidth, newWidth );\n\t\tnewHeight = Math.max( this.state.minHeight, newHeight );\n\n\t\t// Apply aspect ratio if set\n\t\tif ( this.state.aspectRatio ) {\n\t\t\tconst ratio = this.parseAspectRatio( this.state.aspectRatio );\n\t\t\tif ( ratio ) {\n\t\t\t\tconst widthBasedHeight = newWidth / ratio;\n\t\t\t\tconst heightBasedWidth = newHeight * ratio;\n\n\t\t\t\tif ( Math.abs( newWidth - this.dragStartWidth ) > Math.abs( newHeight - this.dragStartHeight ) ) {\n\t\t\t\t\tnewHeight = widthBasedHeight;\n\t\t\t\t} else {\n\t\t\t\t\tnewWidth = heightBasedWidth;\n\t\t\t\t}\n\n\t\t\t\tnewWidth = Math.max( this.state.minWidth, newWidth );\n\t\t\t\tnewHeight = Math.max( this.state.minHeight, newHeight );\n\t\t\t}\n\t\t}\n\n\t\t// Calculate scale ratio to maintain proportional resizing\n\t\tconst scaleX = newWidth / this.dragStartWidth;\n\t\tconst scaleY = newHeight / this.dragStartHeight;\n\t\tconst scale = Math.min( scaleX, scaleY ); // Use uniform scale\n\n\t\t// Update wrapper size\n\t\tthis.state.width = newWidth;\n\t\tthis.state.height = newHeight;\n\t\tthis.updateWrapperDimensions();\n\n\t\t// Update content size proportionally\n\t\tconst newContentWidth = this.dragStartContentWidth * scale;\n\t\tconst newContentHeight = this.dragStartContentHeight * scale;\n\n\t\tthis.state.contentElement.style.width = `${newContentWidth}px`;\n\t\tthis.state.contentElement.style.height = `${newContentHeight}px`;\n\n\t\t// Adjust content position proportionally to keep it centered relative to wrapper\n\t\tthis.state.contentLeft = this.dragStartContentLeft * scale;\n\t\tthis.state.contentTop = this.dragStartContentTop * scale;\n\n\t\t// Clamp content position after scaling\n\t\tthis.clampContentPosition();\n\t}\n\n\tprivate handleCrop ( deltaX : number, deltaY : number, side : string ) : void {\n\t\t// Crop resizes the wrapper (visible area), not the content\n\t\tlet newWidth = this.dragStartWidth;\n\t\tlet newHeight = this.dragStartHeight;\n\n\t\tswitch ( side ) {\n\t\t\tcase 'l': // Left - resize wrapper from left\n\t\t\t\tnewWidth = this.dragStartWidth - deltaX;\n\t\t\t\tbreak;\n\t\t\tcase 'r': // Right - resize wrapper from right\n\t\t\t\tnewWidth = this.dragStartWidth + deltaX;\n\t\t\t\tbreak;\n\t\t\tcase 't': // Top - resize wrapper from top\n\t\t\t\tnewHeight = this.dragStartHeight - deltaY;\n\t\t\t\tbreak;\n\t\t\tcase 'b': // Bottom - resize wrapper from bottom\n\t\t\t\tnewHeight = this.dragStartHeight + deltaY;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Apply minimum constraints\n\t\tnewWidth = Math.max( this.state.minWidth, newWidth );\n\t\tnewHeight = Math.max( this.state.minHeight, newHeight );\n\n\t\t// Apply aspect ratio if set\n\t\tif ( this.state.aspectRatio ) {\n\t\t\tconst ratio = this.parseAspectRatio( this.state.aspectRatio );\n\t\t\tif ( ratio ) {\n\t\t\t\tconst widthBasedHeight = newWidth / ratio;\n\t\t\t\tconst heightBasedWidth = newHeight * ratio;\n\n\t\t\t\tif ( side === 'l' || side === 'r' ) {\n\t\t\t\t\tnewHeight = widthBasedHeight;\n\t\t\t\t} else {\n\t\t\t\t\tnewWidth = heightBasedWidth;\n\t\t\t\t}\n\n\t\t\t\tnewWidth = Math.max( this.state.minWidth, newWidth );\n\t\t\t\tnewHeight = Math.max( this.state.minHeight, newHeight );\n\t\t\t}\n\t\t}\n\n\t\tthis.state.width = newWidth;\n\t\tthis.state.height = newHeight;\n\t\tthis.updateWrapperDimensions();\n\n\t\t// When cropping from left or top, adjust content position\n\t\tif ( side === 'l' ) {\n\t\t\tconst widthDiff = newWidth - this.dragStartWidth;\n\t\t\tthis.state.contentLeft = this.dragStartContentLeft - widthDiff;\n\t\t} else if ( side === 't' ) {\n\t\t\tconst heightDiff = newHeight - this.dragStartHeight;\n\t\t\tthis.state.contentTop = this.dragStartContentTop - heightDiff;\n\t\t}\n\n\t\t// Clamp content position\n\t\tthis.clampContentPosition();\n\t}\n\n\tprivate clampContentPosition () : void {\n\t\tif ( !this.state.contentElement ) return;\n\n\t\tconst contentWidth = this.state.contentElement.offsetWidth;\n\t\tconst contentHeight = this.state.contentElement.offsetHeight;\n\t\tconst minLeft = Math.min( 0, this.state.width - contentWidth );\n\t\tconst minTop = Math.min( 0, this.state.height - contentHeight );\n\n\t\tthis.state.contentLeft = Math.max( minLeft, Math.min( 0, this.state.contentLeft ) );\n\t\tthis.state.contentTop = Math.max( minTop, Math.min( 0, this.state.contentTop ) );\n\n\t\tthis.state.contentElement.style.left = `${this.state.contentLeft}px`;\n\t\tthis.state.contentElement.style.top = `${this.state.contentTop}px`;\n\t}\n\n\tprivate handlePan ( deltaX : number, deltaY : number ) : void {\n\t\tif ( !this.state.contentElement ) return;\n\n\t\t// Pan the content by moving its position\n\t\tthis.state.contentLeft = this.dragStartContentLeft + deltaX;\n\t\tthis.state.contentTop = this.dragStartContentTop + deltaY;\n\n\t\t// Clamp to prevent blank areas\n\t\tthis.clampContentPosition();\n\t}\n\n\tprivate parseAspectRatio ( ratio : string ) : number | null {\n\t\tconst parts = ratio.split( '/' );\n\t\tif ( parts.length === 2 ) {\n\t\t\tconst width = parseFloat( parts[0] );\n\t\t\tconst height = parseFloat( parts[1] );\n\t\t\tif ( !isNaN( width ) && !isNaN( height ) && height !== 0 ) {\n\t\t\t\treturn width / height;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate dispatchChange ( action : 'scale' | 'crop' | 'pan' | 'rotate' | 'move' ) : void {\n\t\tconst detail : ResizableCropEventDetail = {\n\t\t\twidth: this.state.width,\n\t\t\theight: this.state.height,\n\t\t\twrapperLeft: this.state.wrapperLeft,\n\t\t\twrapperTop: this.state.wrapperTop,\n\t\t\tcontentLeft: this.state.contentLeft,\n\t\t\tcontentTop: this.state.contentTop,\n\t\t\taction,\n\t\t\trotation: this.state.rotation,\n\t\t\thandle: this.dragHandle || undefined,\n\t\t};\n\n\t\tthis.dispatchEvent( new CustomEvent( 'rcw:change', { detail } ) );\n\n\t\t// Dispatch the onChange event with full values\n\t\tthis.dispatchOnChange();\n\t}\n\n\tprivate dispatchOnChange () : void {\n\t\tconst values = this.getValues();\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent( 'change', {\n\t\t\t\tdetail: values,\n\t\t\t\tbubbles: true,\n\t\t\t\tcomposed: true,\n\t\t\t} ),\n\t\t);\n\t}\n\n\tprivate render () : void {\n\t\tthis.shadowRoot.innerHTML = `\n\t\t\t<style>\n\t\t\t\t:host {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\t#wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tborder: 2px solid #007bff;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tbackground: rgba(0, 123, 255, 0.05);\n\t\t\t\t}\n\n\t\t\t\t#clipper {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t}\n\n\t\t\t\t::slotted(*) {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tmax-width: none;\n\t\t\t\t\tmax-height: none;\n\t\t\t\t\tcursor: grab;\n\t\t\t\t}\n\n\t\t\t\t::slotted(*:active) {\n\t\t\t\t\tcursor: grabbing;\n\t\t\t\t}\n\n\t\t\t\t#handles-container {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tpointer-events: none;\n\t\t\t\t}\n\n\t\t\t\t.handle {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tborder: 2px solid #007bff;\n\t\t\t\t\tpointer-events: auto;\n\t\t\t\t\ttouch-action: none;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t}\n\n\t\t\t\t.handle.rotate {\n\t\t\t\t\twidth: 10px;\n\t\t\t\t\theight: 10px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\ttop: -18px;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\tcursor: grab;\n\t\t\t\t}\n\n\t\t\t\t.handle.rotate:active {\n\t\t\t\t\tcursor: grabbing;\n\t\t\t\t}\n\n\t\t\t\t.handle.scale {\n\t\t\t\t\twidth: 12px;\n\t\t\t\t\theight: 12px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tcursor: nwse-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.scale.tl {\n\t\t\t\t\ttop: -6px;\n\t\t\t\t\tleft: -6px;\n\t\t\t\t\tcursor: nwse-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.scale.tr {\n\t\t\t\t\ttop: -6px;\n\t\t\t\t\tright: -6px;\n\t\t\t\t\tcursor: nesw-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.scale.bl {\n\t\t\t\t\tbottom: -6px;\n\t\t\t\t\tleft: -6px;\n\t\t\t\t\tcursor: nesw-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.scale.br {\n\t\t\t\t\tbottom: -6px;\n\t\t\t\t\tright: -6px;\n\t\t\t\t\tcursor: nwse-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.crop {\n\t\t\t\t\tbackground: #007bff;\n\t\t\t\t\tcursor: move;\n\t\t\t\t}\n\n\t\t\t\t.handle.crop.t {\n\t\t\t\t\ttop: -2px;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 4px;\n\t\t\t\t\tcursor: ns-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.crop.b {\n\t\t\t\t\tbottom: -2px;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 4px;\n\t\t\t\t\tcursor: ns-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.crop.l {\n\t\t\t\t\tleft: -2px;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\ttransform: translateY(-50%);\n\t\t\t\t\twidth: 4px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tcursor: ew-resize;\n\t\t\t\t}\n\n\t\t\t\t.handle.crop.r {\n\t\t\t\t\tright: -2px;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\ttransform: translateY(-50%);\n\t\t\t\t\twidth: 4px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tcursor: ew-resize;\n\t\t\t\t}\n\n\t\t\t\t:host([disabled]) #wrapper {\n\t\t\t\t\topacity: 0.6;\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t}\n\n\t\t\t\t:host([disabled]) .handle {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t</style>\n\n\t\t\t<div id=\"wrapper\">\n\t\t\t\t<div id=\"clipper\">\n\t\t\t\t\t<slot></slot>\n\t\t\t\t</div>\n\n\t\t\t\t<div id=\"handles-container\">\n\t\t\t\t\t<!-- Rotate handle (top-center) -->\n\t\t\t\t\t<div class=\"handle rotate\" data-action=\"rotate\"></div>\n\n\t\t\t\t\t<!-- Scale handle (only bottom-right corner) -->\n\t\t\t\t\t<div class=\"handle scale br\" data-action=\"scale\" data-corner=\"br\"></div>\n\n\t\t\t\t\t<!-- Crop handles (only right and bottom) -->\n\t\t\t\t\t<div class=\"handle crop b\" data-action=\"crop\" data-side=\"b\"></div>\n\t\t\t\t\t<div class=\"handle crop r\" data-action=\"crop\" data-side=\"r\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t// Public API - Getters and Setters\n\tget width () : number {\n\t\treturn this.state.width;\n\t}\n\n\tset width ( value : number ) {\n\t\tthis.setAttribute( 'width', String( value ) );\n\t}\n\n\tget height () : number {\n\t\treturn this.state.height;\n\t}\n\n\tset height ( value : number ) {\n\t\tthis.setAttribute( 'height', String( value ) );\n\t}\n\n\tget minWidth () : number {\n\t\treturn this.state.minWidth;\n\t}\n\n\tset minWidth ( value : number ) {\n\t\tthis.setAttribute( 'min-width', String( value ) );\n\t}\n\n\tget minHeight () : number {\n\t\treturn this.state.minHeight;\n\t}\n\n\tset minHeight ( value : number ) {\n\t\tthis.setAttribute( 'min-height', String( value ) );\n\t}\n\n\tget aspectRatio () : string | null {\n\t\treturn this.state.aspectRatio;\n\t}\n\n\tset aspectRatio ( value : string | null ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'aspect-ratio', value );\n\t\t} else {\n\t\t\tthis.removeAttribute( 'aspect-ratio' );\n\t\t}\n\t}\n\n\tget disabled () : boolean {\n\t\treturn this.hasAttribute( 'disabled' );\n\t}\n\n\tset disabled ( value : boolean ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'disabled', '' );\n\t\t} else {\n\t\t\tthis.removeAttribute( 'disabled' );\n\t\t}\n\t}\n\n\tget allowCrop () : boolean {\n\t\treturn this.hasAttribute( 'allow-crop' ) ? this.getAttribute( 'allow-crop' ) !== 'false' : true;\n\t}\n\n\tset allowCrop ( value : boolean ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'allow-crop', 'true' );\n\t\t} else {\n\t\t\tthis.setAttribute( 'allow-crop', 'false' );\n\t\t}\n\t}\n\n\tget allowResize () : boolean {\n\t\treturn this.hasAttribute( 'allow-resize' ) ? this.getAttribute( 'allow-resize' ) !== 'false' : true;\n\t}\n\n\tset allowResize ( value : boolean ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'allow-resize', 'true' );\n\t\t} else {\n\t\t\tthis.setAttribute( 'allow-resize', 'false' );\n\t\t}\n\t}\n\n\tget allowRotate () : boolean {\n\t\treturn this.hasAttribute( 'allow-rotate' ) ? this.getAttribute( 'allow-rotate' ) !== 'false' : true;\n\t}\n\n\tset allowRotate ( value : boolean ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'allow-rotate', 'true' );\n\t\t} else {\n\t\t\tthis.setAttribute( 'allow-rotate', 'false' );\n\t\t}\n\t}\n\n\tget allowDrag () : boolean {\n\t\treturn this.hasAttribute( 'allow-drag' ) ? this.getAttribute( 'allow-drag' ) !== 'false' : true;\n\t}\n\n\tset allowDrag ( value : boolean ) {\n\t\tif ( value ) {\n\t\t\tthis.setAttribute( 'allow-drag', 'true' );\n\t\t} else {\n\t\t\tthis.setAttribute( 'allow-drag', 'false' );\n\t\t}\n\t}\n\n\t/**\n\t * Gets the current values including wrapper size, content size, position, and zoom level\n\t */\n\tpublic getValues () : ResizableCropperValues {\n\t\t// Keep wrapperLeft/wrapperTop in sync even when not moved yet.\n\t\tthis._syncWrapperPositionFromLayout( this._getContainerForMove() );\n\n\t\tconst contentWidth = this.state.contentElement?.offsetWidth || 0;\n\t\tconst contentHeight = this.state.contentElement?.offsetHeight || 0;\n\n\t\t// Calculate zoom based on current content size vs initial size\n\t\tconst zoom = this.initialContentWidth > 0 ? contentWidth / this.initialContentWidth : 1;\n\n\t\treturn {\n\t\t\twrapperWidth: this.state.width,\n\t\t\twrapperHeight: this.state.height,\n\t\t\twrapperLeft: this.state.wrapperLeft,\n\t\t\twrapperTop: this.state.wrapperTop,\n\t\t\tcontentWidth,\n\t\t\tcontentHeight,\n\t\t\tcontentLeft: this.state.contentLeft,\n\t\t\tcontentTop: this.state.contentTop,\n\t\t\tzoom,\n\t\t\trotation: this.state.rotation,\n\t\t};\n\t}\n\n\t/**\n\t * Sets the values to reproduce size, zoom and pan\n\t * @param values - The values to set\n\t */\n\tpublic setValues ( values : Partial<ResizableCropperValues> ) : void {\n\t\t// Set wrapper size\n\t\tif ( values.wrapperWidth !== undefined ) {\n\t\t\tthis.state.width = values.wrapperWidth;\n\t\t}\n\t\tif ( values.wrapperHeight !== undefined ) {\n\t\t\tthis.state.height = values.wrapperHeight;\n\t\t}\n\t\tthis.updateWrapperDimensions();\n\n\t\tif ( values.wrapperLeft !== undefined || values.wrapperTop !== undefined ) {\n\t\t\tconst container = this._getContainerForMove();\n\t\t\tthis._ensureAbsolutePositionForMove( container );\n\t\t\tif ( values.wrapperLeft !== undefined ) this.state.wrapperLeft = values.wrapperLeft;\n\t\t\tif ( values.wrapperTop !== undefined ) this.state.wrapperTop = values.wrapperTop;\n\t\t\tthis.style.left = `${this.state.wrapperLeft}px`;\n\t\t\tthis.style.top = `${this.state.wrapperTop}px`;\n\t\t}\n\n\t\tif ( values.rotation !== undefined ) {\n\t\t\tthis.state.rotation = values.rotation;\n\t\t\tthis._applyWrapperTransform();\n\t\t}\n\n\t\tif ( !this.state.contentElement ) {\n\t\t\tthis.dispatchOnChange();\n\t\t\treturn;\n\t\t}\n\n\t\t// Set content size based on zoom or explicit dimensions\n\t\tif ( values.zoom !== undefined && this.initialContentWidth > 0 ) {\n\t\t\tconst newContentWidth = this.initialContentWidth * values.zoom;\n\t\t\tconst newContentHeight = this.initialContentHeight * values.zoom;\n\t\t\tthis.state.contentElement.style.width = `${newContentWidth}px`;\n\t\t\tthis.state.contentElement.style.height = `${newContentHeight}px`;\n\t\t} else if ( values.contentWidth !== undefined ) {\n\t\t\tthis.state.contentElement.style.width = `${values.contentWidth}px`;\n\t\t\tif ( values.contentHeight !== undefined ) {\n\t\t\t\tthis.state.contentElement.style.height = `${values.contentHeight}px`;\n\t\t\t} else {\n\t\t\t\tthis.state.contentElement.style.height = 'auto';\n\t\t\t}\n\t\t}\n\n\t\t// Set content position\n\t\tif ( values.contentLeft !== undefined ) {\n\t\t\tthis.state.contentLeft = values.contentLeft;\n\t\t}\n\t\tif ( values.contentTop !== undefined ) {\n\t\t\tthis.state.contentTop = values.contentTop;\n\t\t}\n\n\t\t// Apply position and clamp\n\t\tthis.clampContentPosition();\n\n\t\t// Dispatch change event\n\t\tthis.dispatchOnChange();\n\t}\n\n\t/**\n\t * Gets a serializable state snapshot of the component including flags, constraints, mode,\n\t * and the current transform/crop values.\n\t */\n\tpublic getState () : ResizableCropperComponentState {\n\t\treturn {\n\t\t\tmode: this._interactionMode,\n\t\t\tdisabled: this.disabled,\n\t\t\tallowCrop: this.allowCrop,\n\t\t\tallowResize: this.allowResize,\n\t\t\tallowRotate: this.allowRotate,\n\t\t\tallowDrag: this.allowDrag,\n\t\t\tminWidth: this.minWidth,\n\t\t\tminHeight: this.minHeight,\n\t\t\taspectRatio: this.aspectRatio,\n\t\t\tvalues: this.getValues(),\n\t\t};\n\t}\n\n\t/**\n\t * Restores a state snapshot produced by getState().\n\t * @param state - State to restore\n\t */\n\tpublic setState ( state : Partial<ResizableCropperComponentState> ) : void {\n\t\tif ( state.disabled !== undefined ) this.disabled = state.disabled;\n\t\tif ( state.allowCrop !== undefined ) this.allowCrop = state.allowCrop;\n\t\tif ( state.allowResize !== undefined ) this.allowResize = state.allowResize;\n\t\tif ( state.allowRotate !== undefined ) this.allowRotate = state.allowRotate;\n\t\tif ( state.allowDrag !== undefined ) this.allowDrag = state.allowDrag;\n\t\tif ( state.minWidth !== undefined ) this.minWidth = state.minWidth;\n\t\tif ( state.minHeight !== undefined ) this.minHeight = state.minHeight;\n\t\tif ( state.aspectRatio !== undefined ) this.aspectRatio = state.aspectRatio;\n\t\tif ( state.mode !== undefined ) this._setInteractionMode( state.mode );\n\t\tif ( state.values ) this.setValues( state.values );\n\t}\n}\n\n/**\n * Conditionally defines the custom element if in a browser environment.\n */\nexport const defineResizableCropper = ( tagName : string = 'liwe3-resizable-cropper' ) : void => {\n\tif ( typeof window !== 'undefined' && !window.customElements.get( tagName ) ) {\n\t\tcustomElements.define( tagName, ResizableCropperElement );\n\t}\n};\n\n// Auto-register with default tag name\ndefineResizableCropper();\n"],"names":["ResizableCropperElement","event","container","hostRect","handle","wrapperRect","eventName","containerRect","originLeft","originTop","deltaX","deltaY","name","oldValue","newValue","mode","nodes","width","height","scaleHandle","rotateHandle","cropHandles","elements","scrollLeft","scrollTop","pointerX","pointerY","deltaDegrees","handleCorner","newWidth","newHeight","ratio","widthBasedHeight","heightBasedWidth","scaleX","scaleY","scale","newContentWidth","newContentHeight","side","widthDiff","heightDiff","contentWidth","contentHeight","minLeft","minTop","parts","action","detail","values","value","zoom","state","defineResizableCropper","tagName"],"mappings":"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"}