{"version":3,"file":"MarkdownPreview.js","sources":["../src/MarkdownPreview.ts"],"sourcesContent":["/**\n * MarkdownPreview Web Component\n * Renders markdown content using a dynamically loaded library\n */\n\nexport class MarkdownPreviewElement extends HTMLElement {\n  declare shadowRoot: ShadowRoot;\n  private _libUrl: string = 'https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js';\n  private _value: string = '';\n  private _isLibLoaded: boolean = false;\n  private _isLoadingLib: boolean = false;\n  private container!: HTMLElement;\n\n  static get observedAttributes() {\n    return ['lib-url', 'value'];\n  }\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.render();\n  }\n\n  connectedCallback() {\n    this.loadLibrary();\n  }\n\n  attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n    if (oldValue === newValue) return;\n\n    if (name === 'lib-url') {\n      this._libUrl = newValue;\n      this._isLibLoaded = false; // Reset loaded state if URL changes\n      this.loadLibrary();\n    } else if (name === 'value') {\n      // Only update internal value if it differs, to avoid loops if we were to reflect\n      if (this._value !== newValue) {\n        this.value = newValue;\n      }\n    }\n  }\n\n  get libUrl(): string {\n    return this._libUrl;\n  }\n\n  set libUrl(value: string) {\n    this.setAttribute('lib-url', value);\n  }\n\n  get value(): string {\n    return this._value;\n  }\n\n  set value(content: string) {\n    this._value = content;\n    this.updateContent();\n    // We do NOT reflect to attribute to avoid performance issues with large content\n  }\n\n  private render() {\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n          font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n          line-height: 1.6;\n          color: #333;\n        }\n        .markdown-body {\n          box-sizing: border-box;\n          min-width: 200px;\n          max-width: 980px;\n          margin: 0 auto;\n          padding: 15px;\n        }\n        img {\n          max-width: 100%;\n        }\n        pre {\n          background-color: #f6f8fa;\n          border-radius: 6px;\n          padding: 16px;\n          overflow: auto;\n        }\n        code {\n          font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;\n          font-size: 85%;\n          background-color: rgba(175, 184, 193, 0.2);\n          padding: 0.2em 0.4em;\n          border-radius: 6px;\n        }\n        pre code {\n          background-color: transparent;\n          padding: 0;\n        }\n        blockquote {\n          border-left: 0.25em solid #d0d7de;\n          color: #656d76;\n          padding: 0 1em;\n          margin: 0;\n        }\n        table {\n          border-spacing: 0;\n          border-collapse: collapse;\n          display: block;\n          width: max-content;\n          max-width: 100%;\n          overflow: auto;\n        }\n        table th,\n        table td {\n          padding: 6px 13px;\n          border: 1px solid #d0d7de;\n        }\n        table tr {\n          background-color: #ffffff;\n          border-top: 1px solid #d8dee4;\n        }\n        table tr:nth-child(2n) {\n          background-color: #f6f8fa;\n        }\n      </style>\n      <div class=\"markdown-body\" id=\"content\"></div>\n    `;\n    this.container = this.shadowRoot.getElementById('content') as HTMLElement;\n  }\n\n  private async loadLibrary() {\n    if (this._isLibLoaded || this._isLoadingLib) return;\n\n    // Check if marked is already available globally\n    if (typeof (window as any).marked === 'function' || (typeof (window as any).marked === 'object' && typeof (window as any).marked.parse === 'function')) {\n      this._isLibLoaded = true;\n      this.updateContent();\n      return;\n    }\n\n    this._isLoadingLib = true;\n\n    try {\n      const script = document.createElement('script');\n      script.src = this._libUrl;\n      script.onload = () => {\n        // Double check if marked is available\n        if (!(window as any).marked) {\n          console.error('MarkdownPreview: Library loaded but window.marked is undefined');\n          this.container.innerHTML = `<div style=\"color: red;\">Error: Markdown library loaded but not found. Try a different URL.</div>`;\n          this._isLoadingLib = false;\n          return;\n        }\n        this._isLibLoaded = true;\n        this._isLoadingLib = false;\n        this.updateContent();\n        this.dispatchEvent(new CustomEvent('library-loaded'));\n      };\n      script.onerror = () => {\n        this._isLoadingLib = false;\n        console.error(`Failed to load markdown library from ${this._libUrl}`);\n        this.container.innerHTML = `<div style=\"color: red;\">Error loading markdown library</div>`;\n      };\n      document.head.appendChild(script);\n    } catch (e) {\n      this._isLoadingLib = false;\n      console.error(e);\n    }\n  }\n\n  private updateContent() {\n    if (!this._isLibLoaded) {\n      if (!this._isLoadingLib) {\n        this.loadLibrary();\n      }\n      return;\n    }\n\n    const marked = (window as any).marked;\n    if (!marked) {\n       console.error('Marked library loaded but not found in window');\n       return;\n    }\n\n    try {\n      // Handle both function style (older marked) and object style (newer marked)\n      const parse = typeof marked === 'function' ? marked : marked.parse;\n      if (typeof parse === 'function') {\n        const html = parse(this._value);\n        // If it returns a promise (async), handle it\n        if (html instanceof Promise) {\n          html.then((res: string) => {\n            this.container.innerHTML = res;\n          });\n        } else {\n          this.container.innerHTML = html;\n        }\n      } else {\n        console.error('Marked parse function not found');\n        this.container.innerHTML = `<div style=\"color: red;\">Error: marked.parse not found</div>`;\n      }\n    } catch (e) {\n      console.error('Error parsing markdown:', e);\n      this.container.innerHTML = `<div style=\"color: red;\">Error parsing markdown</div>`;\n    }\n  }\n}\n\nexport const defineMarkdownPreview = (tagName: string = 'liwe3-markdown-preview') => {\n  if (typeof window !== 'undefined' && !customElements.get(tagName)) {\n    customElements.define(tagName, MarkdownPreviewElement);\n  }\n};\n\ndefineMarkdownPreview();\n"],"names":["MarkdownPreviewElement","name","oldValue","newValue","value","content","script","marked","parse","html","res","e","defineMarkdownPreview","tagName"],"mappings":"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"}